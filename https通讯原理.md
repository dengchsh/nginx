# Https通讯原理

https是基于安全目的的Http通道，其安全基础由SSL层来保证。

最初由netscape公司研发，主要提供了通讯双方的身份认证和加密通信方法。

现在广泛应用于互联网上安全敏感通讯。

![|center](../master/src/https-1.png)


### SSL协议通信过程

```
(1) 浏览器发送一个连接请求给服务器;
    服务器将自己的证书(包含服务器公钥S_PuKey)、对称加密算法种类及其他相关信息返回客户端;

(2) 客户端浏览器检查服务器传送到CA证书是否由自己信赖的CA中心签发。
    若是，执行4步;否则，给客户一个警告信息：询问是否继续访问。

(3) 客户端浏览器比较证书里的信息，
    如证书有效期、服务器域名和公钥S_PK，与服务器传回的信息是否一致，
    如果一致，则浏览器完成对服务器的身份认证。

(4) 服务器要求客户端发送客户端证书(包含客户端公钥C_PuKey)、支持的对称加密方案及其他相关信息。
    收到后，服务器进行相同的身份认证，若没有通过验证，则拒绝连接;

(5) 服务器根据客户端浏览器发送到密码种类，选择一种加密程度最高的方案，用客户端公钥C_PuKey加密后通知到浏览器;

(6) 客户端通过私钥C_PrKey解密后，得知服务器选择的加密方案，
    并选择一个通话密钥key，接着用服务器公钥S_PuKey加密后发送给服务器;

(7) 服务器接收到的浏览器传送到消息，用私钥S_PrKey解密，获得通话密钥key。

(8) 接下来的数据传输都使用该对称密钥key进行加密。
```

![|center](../master/src/https-2.png)

上面所述的是双向认证 SSL 协议的具体通讯过程，服务器和用户双方必须都有证书。

![|center](../master/src/https-3.png)

由此可见，SSL协议是通过非对称密钥机制保证双方身份认证，并完成建立连接，在实际数据通信时通过对称密钥机制保障数据安全性